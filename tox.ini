[tox]
# Use skipsdist for commands that don't need the full package
skipsdist = true
envlist = linting, yaml, detect-secrets, test-unit, test-integration
parallel_show_output = true

[testenv]
basepython = python3.12
# Don't recreate environments if Python version matches
recreate = false

[testenv:linting]
deps = flake8==7.0.0
commands = flake8 src --count --select=E9,F63,F7,F82 --show-source --statistics

[testenv:yaml]
allowlist_externals=bash
deps = yamllint==1.33.0
commands =
    bash -c 'yamllint .github/workflows/*.yml'

[testenv:detect-secrets]
allowlist_externals=bash
deps = detect-secrets==1.5.0
commands =
    bash -c 'git ls-files -z "src/**" "config/**" ".github/**" "*.py" "*.yml" "*.yaml" "*.ini" | xargs -0 detect-secrets-hook --baseline .secrets.baseline --base64-limit 5'

# Unit tests only - no external dependencies
[testenv:test-unit]
skipsdist = false
deps = 
    -e .  # Install the package in development mode
    -r{toxinidir}/requirements-test.txt
commands = 
    pytest src/tests/unit -v
